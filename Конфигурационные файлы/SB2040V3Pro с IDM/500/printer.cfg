

#####################################################################
# Подключаемые модули
#####################################################################
[include mainsail.cfg]
[include timelapse.cfg]            # Конфигурация таймлапсов
[include nozzle_scrub.cfg]          # Очистка сопла
[include stealthburner_leds.cfg]    # Подсветка StealthBurner
[include offmodule.cfg]             # Модуль включения и выключения
[include filament_sensor.cfg]       # Датчик филамента
[include adxl345.cfg]               # Настройка датчика измерения резонансов
[include led.cfg]                   # Макросы освещения области печати
[include start_end.cfg]             # Макросы начала и окончания печати
[include speed_test.cfg]            # Макрос тестирования скоростей и ускорений
[include K-ShakeTune/*.cfg]         # Макрос для автоматизации измерения графиков InputShaping

#####################################################################
# 	                          Подключение MCU
#####################################################################
# Подключаем основную плату MKS8
[mcu]
canbus_uuid: f9493ee3005c
# Подключаем CAN плату в голове
[mcu sb2040]
canbus_uuid:  d4168cca4a71

#--------------------------------------------------------------------

[virtual_sdcard]
path: ~/printer_data/gcodes         # Путь, указывающий, где будут храниться файлы Gcode
#####################################################################
#                     Контроль температуры MCU
#####################################################################

# Температура CAN платы в голове
[temperature_sensor CAN]
sensor_type: temperature_mcu
sensor_mcu: sb2040

# Температура хоста (OrangePi)
[temperature_sensor Host]
sensor_type: temperature_host
#sensor_path: /sys/class/thermal/thermal_zone0/temp
min_temp: -50
max_temp: 100
#####################################################################
#             Основные настройки кинематики принтера
#####################################################################
[printer]
kinematics: corexy
max_velocity: 400
max_accel: 5000
max_z_velocity: 20
max_z_accel: 350
square_corner_velocity: 5.0



#####################################################################
#                     Настройки оси X
#####################################################################
## Драйвер оси X
[stepper_x]
step_pin: PC14                      # Step GPIO pin (высокий уровень срабатывания). Этот параметр обязателен.
dir_pin:  PC13                      # Направление вращения двигателя. Этот параметр обязателен.
enable_pin: !PC15                   # PIN Включение двигателя.
rotation_distance: 40               # Расстояние (в мм), которое проходит ось при одном полном
                                    # обороте шагового двигателя (или конечной передаче, если указано значение gear_ratio).
                                    # Этот параметр обязателен.
microsteps: 32                      # Количество микрошагов на один шаг двигателя
full_steps_per_rotation:200         # Количество шагов для полного оборота вала двигателя
endstop_pin: ^sb2040:gpio20         # PIN, на котором находится концевик оси X
position_min: 0                     # Минимальное положение головы на оси X
position_endstop: 503               # Положение головы, при котором срабатывает концевой выключатель на оси X
position_max: 503                   # Максимальное положение головы на оси X
homing_speed: 180                   # Скорость движения при поиске дома
homing_retract_dist: 5              # Откат (возврат) после нахождения концевого выключателя, в мм.
homing_positive_dir: true           # Направление движения головы по оси X при поиске дома. Если true, голова будет двгигаться к
                                    # к максимальной позиции, если false - к минимальной (в 0)
#--------------------------------------------------------------------
[tmc2209 stepper_x]
uart_pin: PE6                       # PIN по которому будет происходить управление драйвером по UART
interpolate: false                  # Для большей точности ставим false
run_current: 1.2                    # Ток двигателя, в мА
sense_resistor: 0.110               # sense resistor моторов в омах, по умолчанию 0.110


#####################################################################
#                  Настройки оси Y
#####################################################################
[stepper_y]
step_pin: PE5                       # Step GPIO pin (высокий уровень срабатывания). Этот параметр обязателен.
dir_pin: PE4                        # Направление вращения двигателя. Этот параметр обязателен.
enable_pin: !PC15                   # PIN Включение двигателя.
rotation_distance: 40               # Расстояние (в мм), которое проходит ось при одном полном
                                    # обороте шагового двигателя (или конечной передаче, если указано значение gear_ratio).
                                    # Этот параметр обязателен.
microsteps: 32                      # Количество микрошагов на один шаг двигателя
full_steps_per_rotation:200         # Количество шагов для полного оборота вала двигателя
endstop_pin: ^PA15                  # PIN, на котором находится концевик оси Y
position_min: 0                     # Минимальное положение головы на оси Y
position_endstop: 507               # Положение головы, при котором срабатывает концевой выключатель на оси X
position_max: 507                   # Максимальное положение головы на оси X
homing_speed: 180                   # Скорость движения при поиске дома
homing_retract_dist: 5              # Откат (возврат) после нахождения концевого выключателя, в мм.
homing_positive_dir: true           # Направление движения головы по оси X при поиске дома. Если true, голова будет двгигаться к
                                    # к максимальной позиции, если false - к минимальной (в 0)
#--------------------------------------------------------------------
[tmc2209 stepper_y]
uart_pin: PE3                       # PIN по которому будет происходить управление драйвером по UART
interpolate: false                  # Для большей точности ставим false
run_current: 1.2                    # Ток двигателя, в мА
sense_resistor: 0.110               # sense resistor моторов в омах, по умолчанию 0.110

#####################################################################
#                           Настройки оси Z
#####################################################################
## Двигатель Z0
[stepper_z]
step_pin: PE1                       # Step GPIO pin (высокий уровень срабатывания). Этот параметр обязателен.
dir_pin: !PE0                        # Направление вращения двигателя. Этот параметр обязателен.
enable_pin: !PE2                    # PIN Включение двигателя.
rotation_distance: 40               # Расстояние (в мм), которое проходит ось при одном полном
                                    # обороте шагового двигателя (или конечной передаче, если указано значение gear_ratio).
                                    # Этот параметр обязателен.
gear_ratio: 80:16                   # Передаточное число редуктора оси Z
microsteps: 16                     # Количество микрошагов на один шаг двигателя
endstop_pin: PB13                  # PIN, на котором находится концевик оси Z
#position_endstop: 1
position_max: 480                   # Максимальное положение головы на оси Z
position_min: -5                    # Минимальное положение головы на оси Z
homing_speed: 10                    # Скорость движения при поиске дома
second_homing_speed: 3              # Скорость движения при повторном измерении 0 (обычно меньше для увеличения точности)
homing_retract_dist: 3              # Откат (возврат) после нахождения концевого выключателя, в мм.
[tmc2209 stepper_z]
uart_pin: PB7                       # PIN по которому будет происходить управление драйвером по UART
interpolate: false                  # Для большей точности ставим false
run_current: 0.8                      # Ток двигателя, в мА
sense_resistor: 0.110               # sense resistor моторов в омах, по умолчанию 0.110
#--------------------------------------------------------------------
## Двигатель Z1
[stepper_z1]
step_pin: PD6                       # Step GPIO pin (высокий уровень срабатывания). Этот параметр обязателен.
dir_pin: PD5                       # Направление вращения двигателя. Этот параметр обязателен.
enable_pin: !PD7                    # PIN Включение двигателя.
rotation_distance: 40               # Расстояние (в мм), которое проходит ось при одном полном
                                    # обороте шагового двигателя (или конечной передаче, если указано значение gear_ratio).
                                    # Этот параметр обязателен.
gear_ratio: 80:16                   # Передаточное число редуктора оси Z
microsteps: 16                     # Количество микрошагов на один шаг двигателя
[tmc2209 stepper_z1]
uart_pin: PD4                       # PIN по которому будет происходить управление драйвером по UART
interpolate: false                  # Для большей точности ставим false
run_current: 0.8                      # Ток двигателя, в мА
sense_resistor: 0.110               # sense resistor моторов в омах, по умолчанию 0.110
#--------------------------------------------------------------------
##	Двигатель Z2
[stepper_z2]
step_pin: PD2                       # Step GPIO pin (высокий уровень срабатывания). Этот параметр обязателен.
dir_pin: !PD1                        # Направление вращения двигателя. Этот параметр обязателен.
enable_pin: !PD3                    # PIN Включение двигателя.
rotation_distance: 40               # Расстояние (в мм), которое проходит ось при одном полном
                                    # обороте шагового двигателя (или конечной передаче, если указано значение gear_ratio).
                                    # Этот параметр обязателен.
gear_ratio: 80:16                   # Передаточное число редуктора оси Z
microsteps: 16                     # Количество микрошагов на один шаг двигателя
[tmc2209 stepper_z2]
uart_pin: PD0                       # PIN по которому будет происходить управление драйвером по UART
interpolate: false                  # Для большей точности ставим false
run_current: 0.8                      # Ток двигателя, в мА
sense_resistor: 0.110               # sense resistor моторов в омах, по умолчанию 0.110
#--------------------------------------------------------------------
##	Двигатель Z3
[stepper_z3]
step_pin: PC7                       # Step GPIO pin (высокий уровень срабатывания). Этот параметр обязателен.
dir_pin: PC6                       # Направление вращения двигателя. Этот параметр обязателен.
enable_pin: !PC8                    # PIN Включение двигателя.
rotation_distance: 40               # Расстояние (в мм), которое проходит ось при одном полном
                                    # обороте шагового двигателя (или конечной передаче, если указано значение gear_ratio).
                                    # Этот параметр обязателен.
gear_ratio: 80:16                   # Передаточное число редуктора оси Z
microsteps: 16                     # Количество микрошагов на один шаг двигателя
[tmc2209 stepper_z3]
uart_pin: PD15                      # PIN по которому будет происходить управление драйвером по UART
interpolate: false                  # Для большей точности ставим false
run_current: 0.8                      # Ток двигателя, в мА
sense_resistor: 0.110               # sense resistor моторов в омах, по умолчанию 0.110

#####################################################################
#                    Настройки хотэнда и экструдера
#####################################################################
[extruder]
step_pin: sb2040:gpio14              # Step GPIO pin (высокий уровень срабатывания). Этот параметр обязателен.
dir_pin: !sb2040:gpio13             # Направление вращения двигателя. Этот параметр обязателен.
enable_pin: !sb2040:gpio16           # PIN Включение двигателя.
rotation_distance: 22.241           # Расстояние (в мм), которое проходит ось при одном полном
                                    # обороте шагового двигателя (или конечной передаче, если указано значение gear_ratio).
                                    # Этот параметр обязателен.
gear_ratio: 50:10                   # Передаточное число редуктора экструдера
microsteps: 8                      # Количество микрошагов на один шаг двигателя
full_steps_per_rotation: 200        # Количество шагов для полного оборота вала двигателя
nozzle_diameter: 0.400              # Диаметр сопла, значение по умолчанию 0.4.
filament_diameter: 1.75             # Диаметр используемого пластика
heater_pin:  sb2040:gpio23           # PIN управления нагревателем хотэнда
sensor_type: EPCOS 100K B57560G104F    #Тип датчика температуры
sensor_pin: sb2040:gpio27           # PIN датчика температуры
min_temp: -20                       # Минимальная температура хотэнда. Если температура опуститься ниже данного значения, система выдаст ошибку.
max_temp: 330                       # Максимальная температура хотэнда. Если температура превысит данное значения, система выдаст ошибку.
max_power: 1.0                      # Максимальная мощность, которую можно подать на хотэнд. 1 соответствует 100% мощности
min_extrude_temp: 170               # Минимальная температура, при которой возможна экструзия. Если хотэнд нагрет ниже, система выдаст ошибку и
                                    # мотор экструдера не будет вращаться
max_extrude_only_distance: 200      # Максимальное расстояние в мм, на которое можно выдавить пластик за один раз
max_extrude_cross_section: 50       # Максимальная площадь поперечного сечения экструзии (в мм^2) (например, ширина экструзии, умноженная на высоту слоя).
                                    # Эта настройка предотвращает чрезмерное выдавливание при относительно небольших перемещениях XY.
                                    # Если при перемещении требуется скорость экструзии, превышающая это значение, это приведет к возврату ошибки.
                                    # Значение по умолчанию равно: 4.0 * nozzle_diameter^2
pressure_advance: 0.05              # Параметр Pressure Advance, по умочанию 0.05
pressure_advance_smooth_time: 0.040    # Параметр сглаживания Pressure Advance, по умочанию 0.040
[tmc2240 extruder]
uart_pin: sb2040:gpio15
interpolate: True
run_current: 0.55
rref: 12300
stealthchop_threshold: 0
driver_TBL: 2
driver_HSTRT: 5
driver_TOFF: 2
driver_HEND: 3
driver_IHOLDDELAY: 6
#####################################################################
[verify_heater extruder]            # Проверка нагревателя и датчика температуры.
max_error: 120                      # Максимальная "суммарная температурная погрешность" перед выдачей сообщения об ошибке.
                                    # Меньшие значения приводят к более строгой проверке, а большие значения позволяют увеличить время до
                                    # появления сообщения об ошибке. В частности, температура проверяется раз в секунду, и если
                                    # она близка к заданной температуре, то внутренний "счетчик ошибок" сбрасывается;
                                    # в противном случае, если температура ниже заданного диапазона, то счетчик увеличивается на величину,
                                    # на которую указанная температура отличается от этого диапазона.
                                    # Если значение счетчика превышает значение "max_error", выдается сообщение об ошибке.
                                    # Значение по умолчанию равно 120
check_gain_time:120                 # Это позволяет контролировать проверку нагревателя при первоначальном нагреве.
                                    # Меньшие значения приводят к более тщательной проверке, а большие значения позволяют увеличить время
                                    # до появления сообщения об ошибке. В частности, во время первоначального нагрева,
                                    # если температура нагревателя повышается в течение этого периода времени (указанного в секундах),
                                    # внутренний "счетчик ошибок" сбрасывается.
                                    # Значение по умолчанию равно 20 секундам для экструдеров и 60 секундам для нагревательного слоя.
hysteresis: 50                      # Максимальная разница температур (в градусах Цельсия) с заданной температурой,
                                    # которая считается в пределах заданного диапазона. Это позволяет проверить диапазон max_error.
                                    # Это значение редко настраивается. Значение по умолчанию равно 5.
heating_gain: 2                     # Минимальная температура (в градусах Цельсия), на которую должен быть увеличен нагреватель
                                    # во время проверки check_gain_time. Это значение редко настраивается. Значение по умолчанию равно 2.

#####################################################################
#                   Настройка подогреваемого стола
#####################################################################
[heater_bed]
heater_pin: PB10                    # PIN управления нагревателем стола
sensor_type: EPCOS 100K B57560G104F   # Тип датчика температуры
sensor_pin: PC0                     # PIN датчика температуры
max_power: 1.0                      # Максимальная мощность, которую можно подать на стол. 1 соответствует 100% мощности
min_temp: -70                       # Минимальная температура стола. Если температура опуститься ниже данного значения, система выдаст ошибку.
max_temp: 120                       # Максимальная температура стола. Если температура превысит данное значения, система выдаст ошибку.
#####################################################################
#                       Вентиляторы охлаждения
#####################################################################

######################### Вентилятор охлаждения хотэнда ########################
[heater_fan Hotend]
pin: sb2040:gpio19                  # PIN управления вентилятором охлаждения хотэнда
max_power: 1.0                      # Максимальная мощность, которую можно подать на вентилятор. 1 соответствует 100% мощности
kick_start_time: 0.5                # Время (в секундах), необходимое для запуска вентилятора на полной скорости при
                                    # первом включении или увеличении ее более чем на 50% (помогает запустить вентилятор).
                                    # Значение по умолчанию равно 0,100 секунды.
heater: extruder
heater_temp: 50.0                   # Порог запуска вентилятора
fan_speed: 1                        # Позволяет регулировать скорость вентилятора, по умолчанию 1 - 100%
shutdown_speed: 1.0                 # Требуемая скорость вращения вентилятора (выраженная в виде значения от 0,0 до 1,0),
                                    # если программное обеспечение микроконтроллера переходит в состояние ошибки. Значение по умолчанию равно 0.

######################## Вентилятор обдува области печати ########################
[fan]
pin: sb2040:gpio24                  # PIN управления вентилятором обдува деталей
kick_start_time: 0.5               # Время (в секундах), необходимое для запуска вентилятора на полной скорости при
                                   # первом включении или увеличении ее более чем на 50% (помогает запустить вентилятор).
                                   # Значение по умолчанию равно 0,100 секунды.
off_below: 0.1                     # Минимальная входная частота вращения, которая будет обеспечивать питание вентилятора (выражается в виде значения от 0,0 до 1,0).
                                   # При запросе скорости, меньшей, чем off_below, вентилятор будет выключен.
                                   # Эта настройка может использоваться для предотвращения остановки вентилятора и обеспечения его эффективного запуска.
                                   # Значение по умолчанию равно 0,0.
                                   # Эту настройку следует перекалибровать при каждой настройке параметра max_power.
                                   # Чтобы откалибровать эту настройку, начните с значения off_below, равного 0.0, 
                                   # и включите вентилятор. Постепенно уменьшайте скорость вращения вентилятора,
                                   # чтобы определить самую низкую входную скорость, которая обеспечивает
                                   # надежную работу вентилятора без остановок. Установите значение off_below ниже значения рабочего цикла,
                                   # соответствующего этому значению (например, 12% -> 0,12) или немного выше.
cycle_time: 0.05                   # Время (в секундах), затрачиваемое на каждый цикл подачи питания на вентилятор с помощью ШИМ.
                                   # Рекомендуется, чтобы это значение составляло не менее 10 миллисекунд 
                                   # при использовании программной ШИМ. Значение по умолчанию равно 0,010 секунды.
max_power: 1.0                     # Максимальная мощность (выраженная в виде значения от 0,0 до 1,0),
                                   # на которую может быть установлен вентилятор. Значение 1.0 позволяет полностью включить
                                   # контакт на длительное время, в то время как значение 0.5 позволяет включать контакт
                                   # не более чем на половину времени. Эта настройка может использоваться для ограничения
                                   # общей выходной мощности вентилятора (в течение длительного времени).
                                   # Если это значение меньше 1,0, то запросы на скорость вращения вентилятора будут изменяться 
                                   # в диапазоне от нуля до max_power (например, если значение max_power равно 0.9 и
                                   # запрашивается скорость вращения вентилятора 80%, то мощность вентилятора
                                   # будет установлена на 72%). Значение по умолчанию равно 1.0.
                                   
######################## Вентиляторы Nevermore ########################
[duplicate_pin_override]
pins: PC0                           # Указываем Klipper, что будем повторно использовать значения PIN температуры подогреваемого стола
[temperature_fan Nevermore Fan]
pin: PB0                            # PIN управления вентиляторами Nevermore
max_power: 1                        # Максимальная мощность, которую можно подать на вентилятор. 1 соответствует 100% мощности
shutdown_speed: 0.0                 # Требуемая скорость вращения вентилятора (выраженная в виде значения от 0,0 до 1,0),
                                    # если программное обеспечение микроконтроллера переходит в состояние ошибки. Значение по умолчанию равно 0.
kick_start_time: 5.0                # Время (в секундах), необходимое для запуска вентилятора на полной скорости при
                                    # первом включении или увеличении ее более чем на 50% (помогает запустить вентилятор).
                                    # Значение по умолчанию равно 0,100 секунды.
sensor_type: EPCOS 100K B57560G104F # Тип датчика температуры
sensor_pin: PC0                     # PIN датчика температуры
min_temp: -70                       # Минимальная температура стола. Если температура опуститься ниже данного значения, система выдаст ошибку.
max_temp: 130                       # Максимальная температура стола. Если температура превысит данное значения, система выдаст ошибку.
target_temp: 110                    # Температура, которую будет пытаться достичь Nevermore. Так как мы используем значения температуры стола, то
                                    # по сути это температура стола, при которой будет включаться Nevermore
gcode_id: A
control: watermark


########################  Вытяжной вентилятор #########################
# [temperature_fan Вытяжка Fan]
# pin: PA3                            # PIN управления вытяжным вентилятором
# max_power: 1                        # Максимальная мощность, которую можно подать на вентилятор. 1 соответствует 100% мощности
# shutdown_speed: 0.0                 # Требуемая скорость вращения вентилятора (выраженная в виде значения от 0,0 до 1,0),
#                                     # если программное обеспечение микроконтроллера переходит в состояние ошибки. Значение по умолчанию равно 0.
# kick_start_time: 5.0                # Время (в секундах), необходимое для запуска вентилятора на полной скорости при
#                                     # первом включении или увеличении ее более чем на 50% (помогает запустить вентилятор).
#                                     # Значение по умолчанию равно 0,100 секунды.
# sensor_type: ATC Semitec 104GT-2 # Тип датчика температуры
# sensor_pin: sb2040:gpio26           # PIN датчика температуры
# min_temp: -70                       # Минимальная температура в печатной камере. Если температура опуститься ниже данного значения, система выдаст ошибку.
# max_temp: 85                        # Максимальная температура в печатной камере. Если температура превысит данное значения, система выдаст ошибку.
# target_temp: 64                     # Температура в печатной камере по умолчанию, при достижении которой будет включаться вытяжной вентилятор.
# gcode_id: C
# control: watermark

[fan_generic Вытяжка]
pin:PA3
max_power: 1.0

########################  Вентиляторы отсека аппаратуры #########################
[temperature_fan Апп.Отсек Fan]
pin: PA0                            # PIN управления вытяжным вентилятором
max_power: 1                        # Максимальная мощность, которую можно подать на вентилятор. 1 соответствует 100% мощности
shutdown_speed: 0.0                 # Требуемая скорость вращения вентилятора (выраженная в виде значения от 0,0 до 1,0),
                                    # если программное обеспечение микроконтроллера переходит в состояние ошибки. Значение по умолчанию равно 0.
kick_start_time: 5.0                # Время (в секундах), необходимое для запуска вентилятора на полной скорости при
                                    # первом включении или увеличении ее более чем на 50% (помогает запустить вентилятор).
sensor_type: temperature_mcu        # Тип датчика температуры
min_temp: -70                       # Минимальная температура в хост-компьютера. Если температура опуститься ниже данного значения, система выдаст ошибку.
max_temp: 100                       # Максимальная температура в хост-компьютера. Если температура превысит данное значения, система выдаст ошибку.
target_temp: 15                     # Температура хост-компьютера по умолчанию, при достижении которой будет включаться вытяжной вентилятор.
gcode_id: D
control: watermark

#####################################################################
#	          Управление подсветкой печатной камеры
#####################################################################
[neopixel Подсветка]
pin: PA8                            # PIN управления подстветкой
chain_count: 50                     # Количество светодиодов в цепочке подсветки
color_order: GRB                    # Тип светодиодной ленты
initial_RED: 1                      # Первичное значение красного цвета
initial_GREEN: 1                    # Первичное значение зелёного цвета
initial_BLUE: 1                     # Первичное значение синего цвета

#####################################################################
#                          Таймаут принтера
#####################################################################
[idle_timeout]
timeout: 38800                      # Время простоя принтера, при превышении которого принтер сбрасывает текущие задачи. В секундах.
#####################################################################
#             Настройки пробы уровня стола (Euclid)
#####################################################################
[probe_eddy_current mellow_eddy]
sensor_type: ldc1612
i2c_address: 43
i2c_mcu: sb2040
i2c_bus: i2c1b
x_offset: 0
y_offset: 18
speed:40
lift_speed: 5

[temperature_probe mellow_eddy]
sensor_type: Generic 3950
sensor_pin: sb2040:gpio28
horizontal_move_z: 2


#####################################################################
# 	                  Построение карты стола
#####################################################################
[bed_mesh]
speed: 230                          # Скорость перемещения по оси X и Y при построении карты стола
horizontal_move_z: 3                # Высота, на которую будет подниматься ось Z при перемещении для построения карты
mesh_min: 50, 49                    # Точки с минимальными коородинатами x，y которые будет измерены
mesh_max: 450,449                   # Точки с максимальными коородинатами x，y которые будет измерены
fade_start: 0.6                     # На первых слоях голова начинает при своём движении учитывать карту стола и подниматься
                                    # опускаться относительно неё, что бы обеспечить ровные первые слои. Но начиная с
                                    # высоты fade_start принтер начнёт все меньше и меньше учитывать карту стола и плавно
                                    # переходить на ровное движение
fade_end: 10.0                      # Высота, при которой закончиться процесс выравнивания головы отностительно карты стола
fade_target: 0                      # Дополнительное смещение, которое останется после завершения выравнивания
probe_count: 10,10                  # Количество точек сетки стола по осям X и Y
mesh_pps: 2,3                       # Количество точек интерполяции
algorithm: bicubic                  # Алгоритм интерполяции
bicubic_tension: 0.2                # Натяжение интерполяции
zero_reference_position: 250, 250   # Центр измерения сетки

#####################################################################
#                  Настройки выравнивания портала
#####################################################################
[homing_override]
axes: z                             # Ось по которой осуществляется выравнивание
set_position_z: 0                   # Если указано, принтер будет считать, что ось находится в указанном положении до
                                    # выполнения приведенных выше команд с помощью g-кода. Установка этого параметра
                                    # отключает проверку наведения на ось. Это может быть полезно, если перед запуском
                                    # обычного механизма G28 для оси необходимо переместить головку.
                                    # По умолчанию положение оси не задается принудительно.
gcode:
   G90
   G0 Z15 F600
   G28 X Y
   G0 X125.55 Y505 F6600
   G28 Z
   G0 Z20 F1800
[force_move]
enable_force_move: true
[quad_gantry_level]                 # Скорость перемещения по оси X и Y при выравнивании портала
gantry_corners:
	-60,-10
	560,570
points:
    50,50
    50,450
    450,450
    450,50
#--------------------------------------------------------------------
speed: 230                          # Скорость, с которой будет перемещаться голова при QGL
horizontal_move_z: 29               # Высота, на которую будет подниматься ось Z при перемещении для выравнивания портала
retry_tolerance: 0.01               # Точность измерения, которая должна быть получена. Если точность ниже, система выдаст ошибку.
retries: 5                          # Количество повторений измерения. Если после заданного количества
                                    # повторений не будет достигнута заданная точность, система выдаст ошибку
max_adjust: 10                      # Количество повторений процесса выравнивания. Если после заданного количества
                                    # повторений не будет достигнута заданная точность, система выдаст ошибку

[gcode_macro QUAD_GANTRY_LEVEL]
rename_existing: _QUAD_GANTRY_LEVEL
gcode:
    SAVE_GCODE_STATE NAME=STATE_QGL
    BED_MESH_CLEAR
    {% if not printer.quad_gantry_level.applied %}
      _QUAD_GANTRY_LEVEL horizontal_move_z=10 retry_tolerance=1
    {% endif %}
    _QUAD_GANTRY_LEVEL horizontal_move_z=3 METHOD=scan
    # G28 Z
    RESTORE_GCODE_STATE NAME=STATE_QGL
#####################################################################
#            Настройка число-буквенного дисплея 12864mini
#####################################################################
########################################
# EXP1 / EXP2 (display) pins
########################################

[board_pins]
aliases:
    # EXP1 header
    EXP1_10=<5V>, EXP1_9=<GND>,
    EXP1_8=PE7,   EXP1_7=PE15,
    EXP1_6=PD8,  EXP1_5=PD9,
    EXP1_4=PD10,   EXP1_3=PE11,
    EXP1_2=PE10,   EXP1_1=PB2,

    # EXP2 header
    EXP2_10=<5V>, EXP2_9=<GND>,
    EXP2_8=<RST>, EXP2_7=PB11,
    EXP2_6=PA7,   EXP2_5=PE8,
    EXP2_4=PA4,   EXP2_3=PE9,
    EXP2_2=PA5,   EXP2_1=PA6


[output_pin beeper]
pin: EXP1_1                         # PIN, на котором подключен бипер


#####################################################################
#                Настройка движения по кривым
#####################################################################
[gcode_arcs]                        # Подключение механизма движения по кривым линиям
resolution: 0.1                    # Точность при движении по кривым в командах G2，G3
                                    # Кривая будет разделена на несколько сегментов. Длина каждого сегмента будет равна
                                    # указанному разрешению (в мм). Более низкие значения позволят получить более
                                    # точные кривые, но при этом сущетсвенно увеличивают нагрузку на процессор вашего принтера.
                                    # Если дуга меньше заданного значения, она превратится в прямую линию.
                                    # Значение по умолчанию - 0.1 мм.
#####################################################################
#          Возможность исключать объекты во время печати
#####################################################################
[exclude_object]

[firmware_retraction]
retract_length: 0.8
# Длина отката при G10 в мм, а так же длина подачи, возвращаемая при запуске G11
# (но она также включает в себя следующую unretract_extra_length). Значение по умолчанию равно 0 мм.
retract_speed: 35
#  Скорость ретракта в миллиметрах в секунду (мм/с), по умолчанию равна 20 мм/с.
unretract_extra_length: 0
# Дополнительная длина, добавляемая при подаче прутка после ретракта
unretract_speed: 35
# Скорость подачи после ретакта, в мм/с, по умолчанию 10мм/с
[shaketune]
# result_folder: ~/printer_data/config/ShakeTune_results
#    The folder where the results will be stored. It will be created if it doesn't exist.
# number_of_results_to_keep: 3
#    The number of results to keep in the result_folder. The oldest results will
#    be automatically deleted after each runs.
# keep_raw_csv: False
#    If True, the raw CSV files will be kept in the result_folder alongside the
#    PNG graphs. If False, they will be deleted and only the graphs will be kept.
# show_macros_in_webui: True
#    Mainsail and Fluidd doesn't create buttons for "system" macros that are not in the
#    printer.cfg file. If you want to see the macros in the webui, set this to True.
# timeout: 300
#    The maximum time in seconds to let Shake&Tune process the CSV files and generate the graphs.


#####################################################################
#                     Служебные данные и настройки
#####################################################################

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 63.203
#*# pid_ki = 2.967
#*# pid_kd = 336.557
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 31.727
#*# pid_ki = 11.750
#*# pid_kd = 21.416
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 59.4
#*# shaper_type_y = mzv
#*# shaper_freq_y = 42.2
#*#
#*# [probe_eddy_current mellow_eddy]
#*# reg_drive_current = 15
#*# calibrate =
#*# 	0.050000:1413025.855,0.090000:1410619.209,0.130000:1408403.019,
#*# 	0.170000:1406070.043,0.210000:1403955.882,0.250000:1401822.805,
#*# 	0.290000:1399594.611,0.330000:1397749.426,0.370000:1395731.042,
#*# 	0.410000:1393774.082,0.450000:1391863.347,0.490000:1390160.620,
#*# 	0.530000:1388308.714,0.570000:1386649.489,0.610000:1384972.566,
#*# 	0.650000:1383353.632,0.690000:1381638.924,0.730000:1380000.043,
#*# 	0.770000:1378405.642,0.810000:1377043.210,0.850000:1375586.458,
#*# 	0.890000:1374197.667,0.930000:1372717.253,0.970000:1371328.248,
#*# 	1.010000:1369935.878,1.050000:1368630.786,1.090000:1367351.840,
#*# 	1.130000:1366136.836,1.170000:1364900.323,1.210000:1363700.231,
#*# 	1.250000:1362529.184,1.290000:1361397.976,1.330000:1360244.603,
#*# 	1.370000:1359083.908,1.410000:1357954.654,1.450000:1356886.478,
#*# 	1.490000:1355806.347,1.530000:1354749.926,1.570000:1353693.777,
#*# 	1.610000:1352687.713,1.650000:1351682.881,1.690000:1350697.637,
#*# 	1.730000:1349680.666,1.770000:1348734.360,1.810000:1347767.399,
#*# 	1.850000:1346838.847,1.890000:1345910.321,1.930000:1345022.679,
#*# 	1.970000:1344143.998,2.010000:1343308.882,2.050000:1342440.092,
#*# 	2.090000:1341642.248,2.130000:1340808.318,2.170000:1339989.736,
#*# 	2.210000:1339184.546,2.250000:1338362.162,2.290000:1337575.825,
#*# 	2.330000:1336837.311,2.370000:1336095.299,2.410000:1335389.072,
#*# 	2.450000:1334671.942,2.490000:1333983.227,2.530000:1333302.433,
#*# 	2.570000:1332627.116,2.610000:1331939.762,2.650000:1331286.857,
#*# 	2.690000:1330629.037,2.730000:1329994.166,2.770000:1329355.171,
#*# 	2.810000:1328752.898,2.850000:1328148.388,2.890000:1327587.047,
#*# 	2.930000:1326998.646,2.970000:1326408.118,3.010000:1325929.140,
#*# 	3.050000:1325361.258,3.090000:1324800.737,3.130000:1324261.818,
#*# 	3.170000:1323731.451,3.210000:1323255.955,3.250000:1322750.383,
#*# 	3.290000:1322247.982,3.330000:1321751.967,3.370000:1321286.415,
#*# 	3.410000:1320848.349,3.450000:1320423.999,3.490000:1319973.179,
#*# 	3.530000:1319516.229,3.570000:1319048.981,3.610000:1318605.662,
#*# 	3.650000:1318172.736,3.690000:1317811.397,3.730000:1317426.170,
#*# 	3.770000:1317040.337,3.810000:1316637.136,3.850000:1316273.287,
#*# 	3.890000:1315916.011,3.930000:1315576.775,3.970000:1315210.709,
#*# 	4.010000:1314858.526,4.050000:1314494.821
#*# z_offset = 2.945
#*#
#*# [temperature_probe mellow_eddy]
#*# calibration_temp = 25.496291
#*#
#*# [stepper_z]
#*# position_endstop = 0.030
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.000000, -0.005859, -0.005464, -0.005299, -0.009721, 0.002009, 0.010984, 0.010708, 0.015747, 0.023540
#*# 	-0.033760, -0.037872, -0.035910, -0.033872, -0.034829, -0.033257, -0.034951, -0.028493, -0.040912, -0.039567
#*# 	-0.029758, -0.041230, -0.037729, -0.031541, -0.031550, -0.039839, -0.041177, -0.047610, -0.052812, -0.057992
#*# 	-0.011084, -0.017622, -0.015195, -0.018365, -0.018868, -0.019910, -0.023033, -0.021783, -0.020308, -0.030647
#*# 	0.006673, 0.006892, 0.004066, 0.002453, -0.006835, -0.007744, -0.008136, -0.008816, 0.001782, -0.012003
#*# 	0.010663, 0.013027, 0.017948, 0.018677, 0.007207, 0.005909, 0.004353, 0.011428, 0.018059, 0.011679
#*# 	0.005152, 0.007608, 0.014250, 0.012938, 0.011662, 0.010141, 0.007705, 0.006091, 0.010543, 0.007302
#*# 	-0.005119, -0.001580, 0.013256, 0.016448, 0.011644, 0.008761, 0.012056, 0.015383, 0.010960, 0.005320
#*# 	-0.010557, -0.006012, 0.006967, 0.014576, 0.015821, 0.015140, 0.013382, 0.017347, 0.016300, 0.011761
#*# 	0.002181, 0.011385, 0.030088, 0.037023, 0.031143, 0.028182, 0.030948, 0.038574, 0.036904, 0.032310
#*# x_count = 10
#*# y_count = 10
#*# mesh_x_pps = 2
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 50.0
#*# max_x = 449.96
#*# min_y = 49.0
#*# max_y = 448.96
